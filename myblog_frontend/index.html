<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en"> <!--<![endif]-->

	<head>

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

		<title>Hello</title>

		<!-- STYLES -->
		<link
			href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
			rel="stylesheet">
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
			rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Kristi&display=swap" rel="stylesheet">

		<link rel="stylesheet" type="text/css" href="assets/css/plugins.css" />
		<link rel="stylesheet" type="text/css" href="assets/css/custom.css" />
		<link rel="stylesheet" type="text/css" href="assets/css/modalbox.css" />
		<link rel="stylesheet" type="text/css" href="assets/css/main.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="assets/css/style.css" />
		<link rel="stylesheet" type="text/css" media="screen" href="assets/css/perfect-scrollbar.min.css" />
		<!--[if lt IE 9]> <script type="text/javascript" src="js/modernizr.custom.js"></script> <![endif]-->
		<!-- /STYLES -->
		<style>
			#scrollingText {
				/* 设置字体样式 */
				font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
				font-size: 24px;

				/* 设置滚动字幕的样式 */
				background-color: #effbf8;
				color: #333333;
				/* padding: 12px;
      border: 2px solid #87a15b;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); */
			}
			.custom-height {
				height: 300px; /* 自定义高度 */
			}
			.custom-height img {
				object-fit: cover;
				height: 100%;
				width: auto;
			}
			.owl-carousel .item {
				display: inline-block;
				width: auto;
			}
		</style>

	</head>

	<body>

		<!-- PRELOADER -->
		<!-- <div id="preloader">
		<div class="loader_line"></div>
	</div> -->
		<!-- /PRELOADER -->

		<!-- WRAPPER ALL -->
		<div class="elisc_tm_all_wrap w-full h-auto clear-both float-left relative" data-magic-cursor="show"
			data-enter="fadeInLeft" data-exit="">

			<!-- SIDEBAR -->
			<div
				class="elisc_tm_sidebar w-[370px] h-[100vh] fixed left-0 top-0 border-solid border-[rgba(85,82,124,.1)] border-r">
				<div class="sidebar_inner w-full float-left h-auto clear-both text-center">
					<div class="author w-full float-left pt-[60px]">
						<div class="image relative w-[118px] inline-block">
							<img class="relative opacity-0 min-w-full" src="assets/img/thumbs/1-1.jpg" alt="" />
							<a href="list.html">
								<div id="user-avatar"
									class="main absolute inset-0 bg-no-repeat bg-cover bg-center rounded-full"
									data-img-url="assets/img/about/4.png"></div>
							</a>
						</div>
						<div class="name w-full float-left mt-[-19px]">
							<!--						<h3><span id="user-name"><span class="back"></span></span></h3>-->
							<h3>
								<span id="back" class="back"></span>
								<span id="user-name"></span>

							</h3>
						</div>
					</div>
					<div class="menu scrollable w-full float-left">
						<ul class="transition_link h-full flex items-center justify-center flex-col">
							<li class="active mb-[15px]"><a href="#home">首页</a></li>
							<li class="mb-[15px]"><a href="#portfolio">我的相册</a></li>
							<li class="mb-[15px]"><a href="#news" id="news-link">博客中心</a></li>
							<!-- <li><a href="list.html">后台</a></li> -->
						</ul>
					</div>
					<div class="copyright absolute bottom-[200px]">

					</div>
				</div>
			</div>
			<!-- /SIDEBAR -->

			<!-- MAINPART -->
			<div class="elisc_tm_mainpart w-full min-h-[100vh] clear-both float-left pl-[370px]">
				<div class="mainpart_inner w-full min-h-[100vh] clear-both float-left relative">

					<!-- HOME -->

					<div class="elisc_tm_section animated" id="home">
						<!-- <marquee  id="scrollingText" behavior="scroll" direction="right">
					</marquee> -->
						<div class="elisc_tm_home w-full min-h-[100vh] clear-both float-left bg-[#EFFBF8]">
							<marquee id="scrollingText" behavior="scroll" direction="right">
								hello
							</marquee>
							<div class="tm_content w-full max-w-[1250px] h-auto clear-both my-0 mx-auto py-0 px-[20px]">
								<div class="details w-full min-h-[100vh] flex items-center">
									<div class="left w-1/2">
										<div class="title w-full float-left mb-[21px]">
											<h3 class="font-extrabold text-[60px] leading-[70px]">Hi,This is a <span
													class="text-blue-color">Blog Website</span></h3>
											<h3 class="font-extrabold text-[60px] leading-[70px]">
												<span class="cd-headline clip">
													<!-- ANIMATE TEXT VALUES: zoom, rotate-1, letters type, letters rotate-2, loading-bar, slide, clip, letters rotate-3, letters scale, push,  -->
													<span class="blc">Hello</span>
													<span class="cd-words-wrapper">
														<b class="is-visible">World!!</b>
														<b>Coder!!</b>
													</span>
												</span>
											</h3>
										</div>
										<div class="subtitle wfll max-w-[80%] float-left mb-[40px]">
											<p>这是一个博客网站，可以随便逛逛</p>
										</div>
										<!--									<div class="buttons w-full float-left flex items-center mb-[150px]">-->
										<!--										<div class="elisc_tm_button transition_link">-->
										<!--											<a href="login.html">登录</a>-->
										<!--										</div>-->
										<!--										<div class="elisc_tm_button transition_link" data-style="border">-->
										<!--											<a href="register.html">注册</a>-->
										<!--										</div>-->
										<!--									</div>-->
										<!-- 动态显示登录/注册或登出按钮 -->
										<div class="buttons w-full float-left flex items-center mb-[150px]"
											id="authButtons">
											<!-- 登录/注册按钮 -->
											<div class="elisc_tm_button transition_link">
												<a href="login.html" id="loginButton">登录</a>

											</div>
											<div class="elisc_tm_button transition_link" data-style="border">
												<a href="register.html" id="registerButton">注册</a>
											</div>
											<!-- 登出按钮 -->
											<div class="elisc_tm_button transition_link" data-style="border"
												id="logoutButton" style="display: none;">
												<a href="javascript:" onclick="logout()">登出</a>
											</div>
										</div>
										<div class="info w-full float-left">
											<ul class="relative">
												<li>

												</li>
											</ul>
										</div>
									</div>
									<div class="right w-1/2 pl-[50px]">
										<img src="assets/img/about/3.png" alt="" />
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- /HOME -->

					<!-- PORTFOLIO -->
					<div class="elisc_tm_section" id="portfolio">
						<div class="elisc_tm_portfolio w-full float-left pt-[120px]">
							<div class="tm_content w-full max-w-[1250px] h-auto clear-both my-0 mx-auto py-0 px-[20px]">
								<div class="elisc_tm_portfolio_title w-full float-left flex items-end justify-between">
									<div class="elisc_tm_title w-auto float-left">
										<h3 class="text-[40px] font-extrabold">我的相册</h3>
									</div>
								</div>
								<div class="portfolio_list w-full float-left mt-[40px] mb-[120px]">
									<ul id="photoCarousel" class="owl-carousel gallery_zoom mb-[65px]">
										<!-- 动态加载照片卡片 -->
									</ul>
									<script>
										document.addEventListener('DOMContentLoaded', function() {
											console.log('DOMContentLoaded event fired');
											fetch('http://localhost:8080/api/photo/getMyPhoto', {
												method: 'GET',
												credentials: 'include'
											})
													.then(response => response.json())
													.then(data => {
														console.log('Data fetched:', data);
														if (data.code === 0) {
															const photos = data.data;
															renderCarousel(photos);
														} else {
															alert('Failed to load photos: ' + data.message);
														}
													})
													.catch(error => {
														console.error('Error:', error);
													});
										});

										function renderCarousel(photos) {
											const photoCarousel = document.getElementById('photoCarousel');
											console.log('photoCarousel:', photoCarousel);
											if (!photoCarousel) {
												console.error('photoCarousel element not found');
												return;
											}
											photoCarousel.innerHTML = '';
											photos.forEach(photo => {
												const photoItem = `
                    <li class="item">
                        <div class="list_inner">
                            <div class="image relative rounded-[4px] overflow-hidden mb-[25px] custom-height">
                                <img class="relative" src="${photo.photoUrl}" alt="" />
                                <a class="elisc_tm_full_link absolute inset-0 z-[5]" href="${photo.photoUrl}" data-lightbox="gallery"></a>
                            </div>
                        </div>
                    </li>
                `;
												photoCarousel.innerHTML += photoItem;
											});
										}
									</script>
								</div>
							</div>
						</div>

					</div>
					<!-- /PORTFOLIO -->

					<!-- NEWS -->
					<div class="elisc_tm_section" id="news">
						<div class="elisc_tm_news fn_w_sminiboxes w-full float-left py-[120px] px-0">
							<div class="tm_content w-full max-w-[1250px] h-auto clear-both my-0 mx-auto py-0 px-[20px]">
								<div class="elisc_tm_service_title wrapper w-full flex justify-between mb-[50px]">
									<div class="elisc_tm_title w-auto pl-[50px]">
										<h3 class="text-[40px] font-extrabold ">博客中心</h3>
									</div>
								</div>
								<div class="wrapper w-full flex justify-between">

									<div class="right fn_w_sminibox w-[66.6666%] pl-[50px]">
										<div class="elisc_tm_sticky_section">
											<div class="list-responsive w-full float-left relative">
												<ul>
													<li class="mb-[40px] w-full float-left">
														<img class="popup_image" src="assets/img/news/1.jpg" alt="" />
														<div
															class="list_inner w-full float-left relative flex items-center justify-between">
															<div class="info w-1/2">
																<div
																	class="meta w-full float-left flex items-center mb-[12px]">
																	<img class="svg w-[18px] h-[18px]"
																		src="assets/img/svg/calendar.svg" alt="" />
																	<span class="font-medium pl-[8px]">April 12,
																		2023</span>
																</div>
																<div class="title w-full float-left">
																	<h3
																		class="text-[#130F49] text-[28px] font-semibold leading-[36px]">
																		<a href="#">12 unique examples of portfolio
																			websites</a>
																	</h3>
																</div>
															</div>
															<div class="elisc_tm_read_more w-auto">
																<a class="line_effect" href="#">Learn More<span
																		class="inline-block"><img class="svg"
																			src="assets/img/svg/rightArrow.svg"
																			alt="" /></span></a>
															</div>

															<!-- Modalbox Info Start -->
															<div class="news_hidden_details">
																<div class="news_popup_informations">
																	<div class="text">
																		<p>Elisc is a leading web design agency with an
																			award-winning design team that creates
																			innovative, effective websites that capture
																			your brand, improve your conversion rates,
																			and maximize your revenue to help grow your
																			business and achieve your goals.</p>

																	</div>
																</div>
															</div>
															<!-- /Modalbox Info End -->

														</div>
													</li>

												</ul>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- /NEWS -->

				</div>
			</div>
			<!-- /MAINPART -->

			<!-- CURSOR -->
			<div class="mouse-cursor cursor-outer"></div>
			<div class="mouse-cursor cursor-inner"></div>
			<!-- /CURSOR -->

		</div>
		<!-- / WRAPPER ALL -->

		<!-- SCRIPTS -->
		<script src="assets/js/jquery.js"></script>
		<!--[if lt IE 10]> <script type="text/javascript" src="js/ie8.js"></script> <![endif]-->
		<script src="assets/js/plugins.js"></script>
		<script src="assets/js/init.js"></script>

		<script src="assets/js/alpine.min.js" defer></script>

		<script>
			const newsLink = document.getElementById('news-link');
			newsLink.addEventListener('click', () => {
				showBlog();
			});

			function checkLogin() {
				fetch('http://localhost:8080/api/user/current', {
						method: 'GET',
						credentials: 'include'
					})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						const loginButton = document.getElementById('loginButton');
						const registerButton = document.getElementById('registerButton');
						const logoutButton = document.getElementById('logoutButton');

						if (data.code === 0 && data.data) {
							loginButton.style.display = 'none';
							registerButton.style.display = 'none';
							logoutButton.style.display = 'block';
						} else {
							loginButton.style.display = 'block';
							registerButton.style.display = 'block';
							logoutButton.style.display = 'none';
						}
					})
					.catch((error) => {
						console.error('Error:', error);
					});
			}

			function logout() {
				fetch('http://localhost:8080/api/user/logout', {
						method: 'POST',
						credentials: 'include'
					})
					.then(response => response.json())
					.then(data => {
						if (data.code === 0) {
							sessionStorage.removeItem('user');
							window.location.href = 'index.html';
						} else {
							alert(data.message);
						}
					})
					.catch((error) => {
						console.error('Error:', error);
					});
			}

			function loadUserInfo() {
				fetch('http://localhost:8080/api/user/current', {
						method: 'GET',
						credentials: 'include'
					})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						if (data.code === 0 && data.data) {
							const user = data.data;
							document.getElementById('user-avatar').style.backgroundImage = `url(${user.avatarUrl})`;
							document.getElementById('user-name').textContent = user.username;
							document.getElementById('back').textContent = user.username;
						} else {
							// 处理用户未登录的情况
							document.getElementById('user-avatar').style.backgroundImage = `url(assets/img/about/4.png)`;
							document.getElementById('user-name').textContent = 'Guest';
							document.getElementById('back').textContent = 'Guest';
						}
					})
					.catch((error) => {
						console.error('Error:', error);
						// 处理错误情况
						document.getElementById('user-avatar').style.backgroundImage = `url(assets/img/about/4.png)`;
						document.getElementById('user-name').textContent = 'Guest';
						// <h3><span id="user-name"><span className="back"></span></span></h3>
						document.getElementById('back').textContent = 'Guest';
					});
			}

			function showAnnouncement() {
				fetch('http://localhost:8080/api/announcement/getAll')
					.then(response => response.json())
					.then(data => {
						const announcementList = data.data;
						let scrollingText = ""; // 声明一个空字符串用于存储所有公告内容
						announcementList.forEach(announcement => {
							const content = announcement.content;
							const userId = announcement.userId;
							scrollingText += userId + " : " + content + "   "; // 将每个公告内容连接到字符串中，并添加一个空格分隔
						});
						console.log(scrollingText);
						const marqueeElement = document.getElementById('scrollingText');
						marqueeElement.innerText = scrollingText; // 设置滚动字幕的文本内容，并去除首尾空格
						console.log(marqueeElement);
					})
					.catch(error => {
						// 处理请求错误
						console.error('Error:', error);
					});
			}

			document.addEventListener('DOMContentLoaded', showAnnouncement);
			document.addEventListener('DOMContentLoaded', checkLogin);
			document.addEventListener('DOMContentLoaded', loadUserInfo);

			function showBlog() {
				fetch('http://localhost:8080/api/blog/getAllBlog2', {
						method: 'GET',
						credentials: 'include'
					})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						const blogList = data.data;
						blogList.forEach(blog => {
							const id = blog.id;
							const userName = blog.user.username;
							const title = blog.title;
							const content = blog.content;
							const createTime = blog.createTime.replace(/T/g, ' ');
							const updateTime = blog.updateTime.replace(/T/g, ' ');
							console.log(blog)

							var list = document.querySelector(".list-responsive ul");

							var blogCell = document.createElement("li");
							blogCell.className = "mb-[40px] w-full float-left";
							blogCell.innerHTML = `
								<img class="popup_image" src="assets/img/news/1.jpg" alt="" />
								<div
									class="list_inner w-full float-left relative flex items-center justify-between">
									<div class="info w-1/2">
										<div
											class="meta w-full float-left flex items-center mb-[12px]">
											<span class="font-bold mr-[8px]">${userName}</span>
											<img class="svg w-[18px] h-[18px]"
												src="assets/img/svg/calendar.svg" alt="" />
											<span class="font-small pl-[8px]">${createTime}</span>
										</div>
										<div class="title w-full float-left">
											<h3
												class="text-[#130F49] text-[28px] font-semibold leading-[36px]">
												<a href="#">${title}</a>
											</h3>
										</div>
									</div>
									<div class="elisc_tm_read_more w-auto">
										<a class="line_effect" href="#" onclick="viewBlog(${id})">Learn More<span
												class="inline-block"><img class="svg"
													src="assets/img/svg/rightArrow.svg"
													alt="" /></span></a>
									</div>
							
								</div>
							  `;
							list.appendChild(blogCell);
						});
					})
					.catch(error => {
						// 处理请求错误
						console.error('Error:', error);
					});
			}
			
			function viewBlog(id) {
				var button = event.target;
				console.log(id);

				fetch('http://localhost:8080/api/blog/getOneBlog?id=' + id, {
						method: 'GET',
						headers: {
							'Content-Type': 'application/json',
						},
					})
					.then(response => response.json())
					.then(data => {
						const blog = data.data;
						console.log(blog)
						const id = blog.id;
						const title = blog.title;
						const content = blog.content;
						const userName = blog.user.username;
						const avatarUrl = blog.user.avatarUrl;
						const time = blog.createTime.replace(/T/g, ' ');
						window.sessionStorage.setItem('id', id);
						window.sessionStorage.setItem('title', title);
						window.sessionStorage.setItem('content', content);
						window.sessionStorage.setItem('userName', userName);
						window.sessionStorage.setItem('avatarUrl', avatarUrl);
						window.sessionStorage.setItem('time', time);
						window.location.href = "blog.html";
					})
					.catch((error) => {
						console.error('Error:', error);
					});
			}
		</script>
		<!-- /SCRIPTS -->

	</body>
</html>